(()=>{"use strict";!function(){const e={init(){this.bindEvents(),this.setupEmbedResize(),this.checkEmbedSections()},checkEmbedSections(){const e=document.getElementById("embed-code"),t=document.getElementById("embed-output"),n=document.getElementById("embed-preview"),s=document.getElementById("config-json"),o=document.getElementById("saved-configs");e&&""!==e.textContent.trim()&&(t&&(t.style.display="block"),n&&(n.style.display="block")),o&&""!==o.value&&s&&""!==s.value.trim()&&setTimeout(()=>{this.generateEmbed()},100)},bindEvents(){const e=document.getElementById("load-config"),t=document.getElementById("delete-config"),n=document.getElementById("reset-template"),s=document.getElementById("validate-json"),o=document.getElementById("format-json"),i=document.getElementById("generate-embed"),a=document.getElementById("copy-embed"),d=document.getElementById("copy-url");e&&e.addEventListener("click",this.loadConfig.bind(this)),t&&t.addEventListener("click",this.deleteConfig.bind(this)),n&&n.addEventListener("click",this.resetTemplate.bind(this)),s&&s.addEventListener("click",this.validateJSON.bind(this)),o&&o.addEventListener("click",this.formatJSON.bind(this)),i&&i.addEventListener("click",this.generateEmbed.bind(this)),a&&a.addEventListener("click",this.copyEmbed.bind(this)),d&&d.addEventListener("click",this.copyUrl.bind(this))},loadConfig(){const e=document.getElementById("saved-configs"),t=e.options[e.selectedIndex],n=t.dataset.config;if(n)try{const e=JSON.parse(n);document.getElementById("config-name").value=t.value,document.getElementById("config-json").value=JSON.stringify(e,null,2),document.getElementById("referrer-site").value=t.dataset.referrer||"",document.getElementById("state-override").value=t.dataset.state||"",document.getElementById("city-override").value=t.dataset.city||"",this.showValidationMessage("Configuration loaded successfully.","success")}catch(e){this.showValidationMessage("Error loading configuration: "+e.message,"error")}else alert("Please select a configuration to load.")},deleteConfig(){const e=document.getElementById("saved-configs").value;e?confirm(`Are you sure you want to delete the configuration "${e}"?`)&&(document.getElementById("config-to-delete").value=e,document.getElementById("delete-config-form").submit()):alert("Please select a configuration to delete.")},resetTemplate(){if(!confirm("Are you sure you want to reset all fields to default values?"))return;document.getElementById("config-json").value=JSON.stringify({layout:"three-column",hasBackground:!1,actionType:"none",isInline:!1,slidesToShow:3,headline:{show:!0,text:"Featured Facilities Near You",alignment:"left",tag:2},selectedTerms:{amenities:[],clinicalServices:[],levelsOfCare:[],paymentOptions:[],programs:[],treatmentOptions:[]},cardOptions:{hasBackground:!1,showRank:!0,showAddress:!0,showInsurance:!0}},null,2),document.getElementById("config-name").value="",document.getElementById("saved-configs").value="",document.getElementById("referrer-site").value="",document.getElementById("state-override").value="",document.getElementById("city-override").value="";const e=document.getElementById("embed-output"),t=document.getElementById("embed-preview");e&&(e.style.display="none"),t&&(t.style.display="none"),this.showValidationMessage("All fields reset to default values.","success")},validateJSON(){const e=document.getElementById("config-json").value;try{JSON.parse(e)}catch(e){return void this.showValidationMessage("Invalid JSON: "+e.message,"error")}const t=new FormData;t.append("action","rmg_validate_json"),t.append("nonce",rmgPremiumListings.nonce),t.append("json",e),fetch(rmgPremiumListings.ajaxUrl,{method:"POST",credentials:"same-origin",body:t}).then(e=>e.json()).then(e=>{e.success?this.showValidationMessage(e.data.message,"success"):this.showValidationMessage(e.data.message,"error")}).catch(()=>{this.showValidationMessage("Validation request failed.","error")})},formatJSON(){const e=document.getElementById("config-json"),t=e.value;try{const n=JSON.parse(t);e.value=JSON.stringify(n,null,2),this.showValidationMessage("JSON formatted successfully.","success")}catch(e){this.showValidationMessage("Cannot format: Invalid JSON","error")}},generateEmbed(){const e=document.getElementById("config-json").value;let t;try{t=JSON.parse(e)}catch(e){return void this.showValidationMessage("Cannot generate: Invalid JSON","error")}const n=document.getElementById("saved-configs"),s=n.options[n.selectedIndex].dataset.ref||"",o=new URLSearchParams;s?o.append("ref",s):o.append("config",btoa(JSON.stringify(t)));const i=document.getElementById("referrer-site").value.trim();i&&o.append("referrer",i);const a=document.getElementById("state-override").value.trim();a&&o.append("state",a);const d=document.getElementById("city-override").value.trim();d&&o.append("city",d);const l=`${window.location.origin}/embed/listing-cards?${o.toString()}`;this.currentEmbedUrl=l,this.customClassname=t.displayOptions&&t.displayOptions.classname?t.displayOptions.classname:"";const c=this.generateEmbedCode(l,this.customClassname),r=document.getElementById("embed-code"),m=document.getElementById("embed-output"),u=document.getElementById("embed-preview"),g=document.getElementById("preview-iframe");r.textContent=c,m.style.display="block";const y=new URL(l,window.location.origin);y.searchParams.append("parent_url",window.location.href),y.searchParams.append("parent_host",window.location.hostname),y.searchParams.append("parent_referrer",document.referrer||""),y.searchParams.append("parent_title",document.title),g.src=y.toString(),u.style.display="block",this.showValidationMessage("Embed code generated successfully!","success"),m.scrollIntoView({behavior:"smooth",block:"start"})},generateEmbedCode(e,t=""){const n=t?`rmg-premium-listings-embed ${t}`:"rmg-premium-listings-embed",s="rmg-premium-listings-embed-"+Date.now();return`\x3c!-- RMG Premium Listings Embed --\x3e\n<div id="${s}" class="${n}"></div>\n<script>\n(function() {\n\tvar u = new URL('${e}');\n\tu.searchParams.append('parent_url', location.href);\n\tu.searchParams.append('parent_host', location.hostname);\n\tu.searchParams.append('parent_referrer', document.referrer);\n\tu.searchParams.append('parent_title', document.title);\n\n\tvar i = document.createElement('iframe');\n\ti.src = u;\n\ti.style.cssText = 'width:100%;border:none;overflow:hidden';\n\ti.scrolling = 'no';\n\n\taddEventListener('message', function(e) {\n\t\tif (e.data.type === 'rmg-embed-resize') i.style.height = e.data.height + 'px';\n\t});\n\n\tdocument.getElementById('${s}').appendChild(i);\n})();\n<\/script>`},copyEmbed(){const e=document.getElementById("embed-code").textContent,t=document.getElementById("copy-success");navigator.clipboard.writeText(e).then(()=>{t.style.display="inline",setTimeout(()=>{t.style.display="none"},2e3)}).catch(()=>{const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),t.style.display="inline",setTimeout(()=>{t.style.display="none"},2e3)})},copyUrl(){const e=this.currentEmbedUrl,t=document.getElementById("url-copy-success");e?navigator.clipboard.writeText(e).then(()=>{t.style.display="inline",setTimeout(()=>{t.style.display="none"},2e3)}).catch(()=>{const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),t.style.display="inline",setTimeout(()=>{t.style.display="none"},2e3)}):this.showValidationMessage("Please generate embed code first.","error")},showValidationMessage(e,t){const n=document.getElementById("validation-message");n.className="rmg-validation-message "+t,n.textContent=e,n.style.display="block",setTimeout(()=>{n.style.display="none"},3e3)},setupEmbedResize(){window.addEventListener("message",e=>{if("rmg-embed-resize"===e.data.type){const t=document.getElementById("preview-iframe");t&&(t.style.height=e.data.height+"px")}})}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{e.init()}):e.init()}()})();