/**
 * Frontend and editor styles for Listing Cards V2 block.
 *
 * These styles are applied both on the frontend and in the editor.
 */

:root {
	// Primitive color variables (can be overridden for theming)
	--rmg-very-light-blue: #EEF5FE;
	--rmg-sky-blue: #A5C2F4;
	--rmg-light-blue: #b0d0e5;
	--rmg-bright-blue: #2E5BCC;
	--rmg-royal-blue: #0462E7;
	--rmg-dark-blue: #081253;
	--rmg-background-blue: #D6D9F2;
	--rmg-white: #ffffff;
	--rmg-grey-100: #f5f6f8;
	--rmg-grey-200: #f3f2f1;
	--rmg-grey-400: #ceced3;
	--rmg-grey-600: #6C6C79;
	--rmg-grey-700: #26262c;
	--rmg-green: #3f8010;

	// Semantic color variables (these can be overridden by embed parameters)
	// Custom embed variables (--rmg-text-color, --rmg-bg-color, --rmg-border-color, --rmg-font-family)
	// are injected via the embed template when provided as URL parameters
	--rmg-color-core-primary: var(--rmg-text-color, var(--rmg-dark-blue));
	--rmg-color-core-accent: var(--rmg-bright-blue);
	--rmg-color-core-subtle: var(--rmg-light-blue);

	// Component-specific variables
	--listing-cards-max-width: 100%;
}

// Mixins for common patterns
@mixin line-clamp($lines: 1) {
	-webkit-line-clamp: $lines;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

@mixin flex-center {
	display: flex;
	align-items: center;
	justify-content: center;
}

@mixin flex-horizontal {
	align-items: stretch;
	display: flex;
	flex-direction: row;
	gap: 1rem;
}

@mixin hover-focus-styles {
	&:active,
	&:hover,
	&:focus-visible {
		@content;
	}
}

@mixin image-transform {
	height: 100%;
	width: 100%;
	object-fit: cover;
	transition: transform 0.3s ease;
}

@mixin hide-scrollbar {
	&::-webkit-scrollbar {
		display: none;
	}
}

@mixin list-reset {
	list-style: none;
	padding: 0;
	margin: 0;
}

@mixin scroll-snap-container {
	overflow-x: auto;
	scroll-snap-align: start;
	scroll-snap-type: x mandatory;
	scroll-snap-stop: always;

	@include hide-scrollbar;
}

.rmg-embed-body .wp-block-rmg-premium-listings-cards {
	margin: var(--rmg-margin, 0);
}

// Base component styles
.wp-block-rmg-premium-listings-cards {
	color: var(--rmg-color-core-primary);
	font-family: var(--rmg-font-family, 'Lato', sans-serif);
	margin: var(--rmg-margin, 0 auto 2rem);
	width: 100%;

	&.has-background {
		background: var(--rmg-bg-color, var(--rmg-very-light-blue));
		border-radius: var(--rmg-border-radius, 16px);
		padding: var(--rmg-padding, 1.5rem);
	}

	// Initial slider styles.
	[data-slider-initialized="true"] {
		opacity: 1 !important;

		+ .slider-controls .slider-prev,
		+ .slider-controls .slider-next {
			opacity: 1 !important;
		}
	}

	// Headline styles
	.listing-headline {
		color: var(--rmg-heading-color, var(--rmg-color-core-primary));
		line-height: 1;
		margin-bottom: 1.25rem;
		text-align: left;

		&.align-center { text-align: center; }
		&.align-right { text-align: right; }
	}

	h2.listing-headline {
		font-size: 1.5rem;

		@media (min-width: 768px) {
			font-size: 2rem;
		}
	}

	h3.listing-headline {
		font-size: 1.5rem;
	}

	// Inline layout specific styles
	&.inline {
		@media (min-width: 992px) and (max-width: 1201px) {
			.cards-grid.layout-slider .slider-container .listing-card {
				max-width: 100%;
			}
		}
	}

	// Card styles
	.listing-card {
		border-radius: var(--rmg-border-radius, 16px);
		border: 2px solid var(--rmg-border-color, var(--rmg-color-core-primary));
		overflow: hidden;
		padding: 1rem;
		scroll-snap-align: start;
		transition: border-color 0.3s ease;

		// Hover states
		&:has(.card-title a:hover, .card-title a:focus-visible, .card-image a:hover, .card-image a:focus-visible) {
			border-color: var(--rmg-border-hover-color, var(--rmg-background-blue));

			.card-title a {
				color: var(--rmg-text-hover-color, var(--rmg-bright-blue));
			}

			&.has-background {
				border-color: var(--rmg-border-color, var(--rmg-color-core-primary));
			}

			.card-image > a > div[id^="map_"],
			.card-image > a > img {
				transform: scale(1.04);
			}
		}

		&.has-background {
			background: var(--rmg-white);
			border: 2px solid var(--rmg-border-hover-color, var(--rmg-background-blue));
		}

		// Card image
		.card-image {
			background-color: var(--rmg-light-blue);
			border-radius: 8px;
			height: 154px;
			margin-bottom: 1rem;
			overflow: hidden;
			position: relative;
			width: 100%;

			a {
				display: block;
				text-decoration: none;
				width: 100%;
				height: 100%;
			}

			.card-image-placeholder {
				border-radius: 8px;
				height: 100%;
				text-indent: -9999px;
				width: 100%;
			}

			> a > img,
			> a > div[id^="map_"],
			> a > iframe {
				@include image-transform;

				pointer-events: none;
				vertical-align: middle;
			}

			> a > iframe {
				height: calc(100% + 40px);
				left: 0;
				max-width: none;
				min-height: 100%;
				min-width: 100%;
				position: absolute;
				top: 0;
				transform: translate(0, -40px);
			}

			.ad-badge {
				@include flex-center;

				background-color: var(--rmg-white);
				border-radius: 8px;
				font-size: 0.875rem;
				font-weight: 400;
				height: 25px;
				line-height: 1;
				padding: 4px 8px;
				position: absolute;
				right: 12px;
				top: 12px;
				width: 34px;
			}
		}

		.card-main {
			margin-bottom: 1rem;
		}

		// Card title
		.card-title {
			font-feature-settings: 'liga' off;
			font-size: 1.25rem;
			font-weight: 900;
			line-height: 1.3;
			margin-bottom: 0.5rem;
			transition: color 0.2s ease;

			a {
				@include line-clamp;

				color: var(--rmg-color-core-primary);
				display: block;
				text-decoration: none;
				transition: color 0.2s ease;
			}
		}

		// Awards section
		.awards {
			.award {
				@include flex-center;

				border-radius: 4px;
				color: var(--rmg-color-core-primary);
				gap: 8px;
				min-height: 26px;
				overflow: hidden;
				justify-content: flex-start;
			}

			.award-badge {
				@include flex-center;

				background-size: 18px;
				flex: 0 0 auto;
				font-size: 10px;
				font-weight: 700;
				height: 22px;
				line-height: 19px;
				position: relative;
				text-align: center;
				top: 2px;
				width: 20px;

				span {
					position: relative;
					z-index: 1;
				}

				svg {
					position: absolute;
					top: 0;
					left: 0;
					width: 100%;
					height: 100%;
					z-index: 0;
				}
			}

			.award-description {
				@include line-clamp;

				max-width: 100%;
				word-break: break-word;
				font-size: 1rem;
				font-weight: 400;
				line-height: 1.2;

				strong {
					font-weight: 900;
				}
			}
		}

		// Location and rating styles
		.rating-reviews,
		.card-location {
			font-size: 0.875rem;
			color: var(--rmg-grey-700);
			line-height: 1.4;
			font-weight: 400;
		}

		.card-location {
			@include line-clamp;
			@include flex-center;

			min-height: 26px;
			justify-content: flex-start;

			.zip-code {
				&::before {
					content: '\00B7';
					color: var(--rmg-sky-blue);
					margin: 0 0.5rem;
				}
			}
		}

		.card-footer {
			display: flex;
			justify-content: space-between;
			align-items: center;
			flex-wrap: wrap;
			gap: 0.75rem;
		}

		.card-rating {
			@include flex-center;

			gap: 0.375rem;

			.rating-score {
				background: var(--rmg-color-core-primary);
				color: var(--rmg-white);
				font-size: 1rem;
				font-weight: 900;
				line-height: 1.2;
				border-radius: 6px;
				padding: 4px 8px;
			}
		}

		.insurance-badge {
			@include flex-center;

			color: var(--rmg-green);
			font-size: 0.875rem;
			font-weight: 400;
			gap: 0.375rem;
			line-height: 1.4;
			justify-content: flex-start;

			svg {
				fill: var(--rmg-green);
			}
		}
	}

	// Cards grid layouts
	.cards-grid {
		@include list-reset;
		gap: 1.5rem;

		.slider-container {
			@include list-reset;
		}

		// Vertical layout
		&.layout-vertical {
			display: flex;
			flex-direction: column;

			.listing-card {
				padding: 8px;

				@include flex-horizontal;

				> article,
				> aside {
					max-width: 100%;

					@include flex-horizontal;
				}

				.card-image {
					flex: 0 0 160px;
					max-height: 140px;
					height: 140px;
					margin: 0;

					@media (min-width: 768px) {
						flex: 0 0 232px;
					}

					@media (max-width: 767px) {
						max-height: 100px;
					}

					> a > div[id^="map_"],
					> a > img {
						@include image-transform;
					}

					.ad-badge {
						font-size: 12px;
						left: 12px;
						padding: 3px 8px;
						right: auto;
						top: 12px;
					}
				}

				.card-title {
					@media (max-width: 767px) {
						font-size: 1rem;
					}
				}

				.card-content {
					display: flex;
					flex-direction: column;
					flex: 0 0 auto;
					width: calc(100% - 160px - 1rem);

					@media (min-width: 768px) {
						width: calc(100% - 232px - 1rem);
					}
				}

				.card-footer {
					align-items: flex-start;
					flex-direction: column;

					> div:nth-child(2) {
						display: none;

						@media (min-width: 768px) {
							display: flex;
						}
					}
				}
			}
		}

		// Three column and slider layouts
		&.layout-three-column,
		&.layout-slider {
			position: relative;

			.slider-container {
				display: flex;
				flex-flow: row nowrap;
				gap: 1.5rem;
				opacity: 1;
				transition: opacity 0.3s ease;

				@include scroll-snap-container;

				.listing-card {
					opacity: 1;
					scroll-snap-align: start;
					scroll-snap-stop: always;

					@media (max-width: 1199px) {
						flex: 0 0 25rem;
						max-width: 75vw;
					}

					@media (min-width: 1200px) {
						$calc-space: calc((.92 + (var(--slides-to-show) - 2) * 0.1) * 1rem);

						min-width: calc((100% / var(--slides-to-show)) - #{$calc-space});
					}

					.editor-styles-wrapper & {
						$calc-space: calc((3 + (var(--slides-to-show) - 2) * 0.25) * 1rem);

						flex: 0 0 calc((100% / var(--slides-to-show)) - #{$calc-space});
						max-width: calc(100% / var(--slides-to-show));
						min-width: 0;
					}
				}
			}
		}

		// Slider specific styles
		&.layout-slider {

			.slider-container:not([data-slider-initialized]) {
				opacity: 0;
			}

			%slider-button {
				@include flex-center;

				backdrop-filter: blur(20px);
				background-color: var(--rmg-white);
				border-radius: 8px;
				border: 1px solid var(--rmg-color-core-primary);
				box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.15);
				cursor: pointer;
				display: none;
				height: 48px;
				opacity: 0;
				padding: 0.5rem;
				position: absolute;
				top: 50%;
				transform: translateY(-50%);
				transition: all 0.3s ease-in-out;
				transition-delay: 0.5s;
				width: 48px;
				z-index: 10;

				@media (min-width: 768px) {
					display: flex;
				}

				svg {
					fill: var(--rmg-grey-700);
					width: 16px;
					height: 28px;
					vertical-align: middle;
					transition: all 0.3s ease-in-out;
				}

				&:disabled {
					opacity: 0 !important;
					pointer-events: none;
				}

				@include hover-focus-styles {
					svg {
						width: 18px;
						height: 18px;
					}
				}
			}

			.slider-prev {
				@extend %slider-button;
				left: 8px;

				svg {
					transform: rotate(180deg);
					margin-right: 3px;
				}
			}

			.slider-next {
				@extend %slider-button;
				right: 8px;

				svg {
					margin-left: 3px;
				}
			}
		}
	}

	// Listing tabs
	.listing-tabs {
		margin: 1.5rem 0 1rem;

		.tab-buttons {
			display: flex;

			@include scroll-snap-container;

			.tab-button {
				background-color: var(--rmg-white);
				border-radius: 8px;
				border: 1px solid var(--rmg-white);
				color: var(--rmg-color-core-primary);
				font-size: 1.125rem;
				font-weight: 400;
				line-height: 1.4;
				margin-right: 0.5rem;
				padding: 8px 16px;
				text-decoration: none;
				transition: all 0.2s ease;
				white-space: nowrap;

				@include hover-focus-styles {
					border: 1px solid var(--rmg-color-core-primary);
				}

				&.active {
					background-color: var(--rmg-color-core-primary);
					border: 1px solid var(--rmg-color-core-primary);
					color: var(--rmg-white);
					pointer-events: none;
				}
			}
		}
	}
}

//-----------------------------------------
// Placeholder Styles
//-----------------------------------------
.listing-cards-loading {
	text-align: center;
	padding: 60px 0;

	.loading-spinner {
		width: 50px;
		height: 50px;
		border: 5px solid var(--rmg-light-blue);
		border-top-color: var(--rmg-bright-blue);
		border-radius: 50%;
		animation: spin 1s linear infinite;
		margin: 0 auto 20px;
	}

	@keyframes spin {
		0% { transform: rotate(0deg); }
		100% { transform: rotate(360deg); }
	}

	p {
		color: #666;
		font-size: 16px;
		margin: 0;
	}
}
